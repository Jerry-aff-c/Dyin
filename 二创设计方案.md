æˆ‘å°†ä¸ºæ‚¨ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„å¤§æ¨¡å‹æç¤ºè¯ï¼ŒæŒ‡å¯¼åŸºäº `erma0/douyin` é¡¹ç›®çš„äºŒæ¬¡å¼€å‘ã€‚

# ğŸš€ æŠ–éŸ³å¤šç”¨æˆ·ç›‘æ§å¹³å°å¼€å‘æŒ‡ä»¤

## é¡¹ç›®æ¦‚è¿°
**ç›®æ ‡**ï¼šåœ¨ `erma0/douyin` å¼€æºé¡¹ç›®åŸºç¡€ä¸Šï¼Œå¼€å‘ä¸€ä¸ªå®Œå…¨ç¦»çº¿çš„å¤šç”¨æˆ·æŠ–éŸ³æ•°æ®ç›‘æ§å¹³å°ï¼Œæ”¯æŒæˆæƒéªŒè¯ã€å®æ—¶æ•°æ®å±•ç¤ºå’Œæ‰¹é‡ä¸‹è½½ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. æœ€å¤§é™åº¦é‡ç”¨åŸé¡¹ç›®ä»£ç ï¼ˆçˆ¬è™«æ ¸å¿ƒã€ä¸‹è½½åŠŸèƒ½ã€UIç»„ä»¶ï¼‰
2. åªæ‰©å±•ä¸é‡å†™ï¼Œä¿æŒæŠ€æœ¯æ ˆä¸€è‡´
3. å®Œå…¨ç¦»çº¿è¿è¡Œï¼Œæ•°æ®ç”¨æˆ·éš”ç¦»

## ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶æ­å»º

### 1.1 æ‰©å±•ç”¨æˆ·æ•°æ®æ¨¡å‹
**åŸæ–‡ä»¶å®šä½**ï¼š`backend/models.py`ï¼ˆå¦‚æ— åˆ™åˆ›å»ºï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# åœ¨åŸæ¨¡å‹åŸºç¡€ä¸Šæ‰©å±•ï¼ˆå¦‚æœåŸé¡¹ç›®å·²æœ‰BaseModelï¼Œåˆ™ç»§æ‰¿ä¹‹ï¼‰
from datetime import datetime
from typing import Optional
import json
import os

class UserConfig:
    """ç”¨æˆ·é…ç½®æ¨¡å‹ - æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹å­˜å‚¨"""
    def __init__(self, user_id: str = None):
        self.user_id = user_id or self.generate_user_id()
        self.sec_user_id = ""  # ç”¨æˆ·ç»‘å®šçš„æŠ–éŸ³sec_uid
        self.license_key = ""  # æˆæƒç 
        self.trial_start_time: Optional[datetime] = None  # è¯•ç”¨å¼€å§‹æ—¶é—´
        self.license_expiry: Optional[datetime] = None    # æˆæƒè¿‡æœŸæ—¶é—´
        self.created_at = datetime.now()
        self.last_updated = datetime.now()
        
        # é‡ç”¨åŸé¡¹ç›®é…ç½®
        from backend.config import load_config  # å‡è®¾åŸé¡¹ç›®æœ‰é…ç½®åŠ è½½
        self.app_config = load_config()  # åŸé¡¹ç›®å…¨å±€é…ç½®
        
    def save(self):
        """ä¿å­˜ç”¨æˆ·é…ç½®åˆ°ç‹¬ç«‹æ–‡ä»¶"""
        user_dir = self.get_user_data_dir()
        os.makedirs(user_dir, exist_ok=True)
        
        config_path = os.path.join(user_dir, 'user_config.json')
        with open(config_path, 'w', encoding='utf-8') as f:
            json.dump({
                'user_id': self.user_id,
                'sec_user_id': self.sec_user_id,
                'license_key': self.license_key,
                'trial_start_time': self.trial_start_time.isoformat() if self.trial_start_time else None,
                'license_expiry': self.license_expiry.isoformat() if self.license_expiry else None,
                'created_at': self.created_at.isoformat(),
                'app_config': self.app_config  # ä¿ç•™åŸé…ç½®
            }, f, ensure_ascii=False, indent=2)
    
    @staticmethod
    def get_user_data_dir(user_id: str = None) -> str:
        """è·å–ç”¨æˆ·æ•°æ®ç›®å½• - é‡ç”¨åŸé¡¹ç›®æ•°æ®ç›®å½•ç»“æ„"""
        base_dir = os.path.expanduser('~/.douyin_monitor')  # ä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´
        if user_id:
            return os.path.join(base_dir, 'users', user_id)
        return base_dir
```

### 1.2 åˆ›å»ºæˆæƒéªŒè¯æ¨¡å—
**æ–°æ–‡ä»¶**ï¼š`backend/auth/license_manager.py`

**å®ç°è¦ç‚¹**ï¼š
```python
import base64
import json
from datetime import datetime
from ecdsa import VerifyingKey, NIST256p, BadSignatureError
import hashlib

class LicenseManager:
    """ç¦»çº¿æˆæƒéªŒè¯ç®¡ç†å™¨"""
    
    # å†…ç½®å…¬é’¥ï¼ˆç”±ä½ ç”Ÿæˆå¹¶ç¡¬ç¼–ç ï¼Œå¯¹åº”ä½ çš„ç§é’¥ï¼‰
    PUBLIC_KEY_HEX = "3059301306072a8648ce3d020106082a8648ce3d030107034200..."  # ç¤ºä¾‹
    
    @classmethod
    def verify_license(cls, license_key: str) -> dict:
        """éªŒè¯æˆæƒç å¹¶è¿”å›è§£æåçš„æ•°æ®"""
        try:
            # 1. Base64è§£ç 
            decoded = base64.b64decode(license_key).decode('utf-8')
            license_data = json.loads(decoded)
            
            # 2. åˆ†ç¦»æ•°æ®å’Œç­¾å
            data_str = json.dumps(license_data['data'], sort_keys=True)
            signature = base64.b64decode(license_data['sig'])
            
            # 3. ä½¿ç”¨å†…ç½®å…¬é’¥éªŒè¯ç­¾å
            vk = VerifyingKey.from_string(bytes.fromhex(cls.PUBLIC_KEY_HEX), curve=NIST256p)
            
            if not vk.verify(signature, data_str.encode('utf-8')):
                return {"valid": False, "error": "ç­¾åéªŒè¯å¤±è´¥"}
            
            # 4. æ£€æŸ¥è¿‡æœŸæ—¶é—´
            expiry_date = datetime.fromisoformat(license_data['data']['expiry'])
            if expiry_date < datetime.now():
                return {"valid": False, "error": "æˆæƒå·²è¿‡æœŸ"}
            
            return {
                "valid": True,
                "type": license_data['data']['type'],
                "expiry": expiry_date,
                "serial": license_data['data']['serial']
            }
            
        except Exception as e:
            return {"valid": False, "error": f"æˆæƒç æ ¼å¼é”™è¯¯: {str(e)}"}
    
    @classmethod
    def check_trial_period(cls, user_config: UserConfig) -> bool:
        """æ£€æŸ¥è¯•ç”¨æœŸçŠ¶æ€"""
        if not user_config.trial_start_time:
            # é¦–æ¬¡ä½¿ç”¨ï¼Œå¼€å§‹è¯•ç”¨
            user_config.trial_start_time = datetime.now()
            user_config.save()
            return True
        
        # æ£€æŸ¥æ˜¯å¦è¶…è¿‡24å°æ—¶
        trial_end = user_config.trial_start_time + timedelta(hours=24)
        return datetime.now() < trial_end
```

### 1.3 æ‰©å±•åç«¯è·¯ç”±
**åŸæ–‡ä»¶å®šä½**ï¼š`backend/routers/` ç›®å½•ï¼ˆåŸé¡¹ç›®å¯èƒ½å·²æœ‰ï¼‰

**æ–°æ–‡ä»¶**ï¼š`backend/routers/monitor.py`
```python
from fastapi import APIRouter, Depends, HTTPException
from typing import List
import asyncio

router = APIRouter(prefix="/api/monitor", tags=["monitor"])

# ä¾èµ–æ³¨å…¥ï¼šè·å–å½“å‰ç”¨æˆ·é…ç½®
async def get_current_user(request):
    """ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ·IDå¹¶åŠ è½½é…ç½®"""
    user_id = request.headers.get('X-User-ID') or request.cookies.get('user_id')
    if not user_id:
        raise HTTPException(status_code=401, detail="æœªç™»å½•")
    
    user_config = UserConfig(user_id)
    # æ£€æŸ¥æˆæƒçŠ¶æ€
    if not check_user_access(user_config):
        raise HTTPException(status_code=403, detail="æˆæƒå·²è¿‡æœŸ")
    
    return user_config

@router.get("/status")
async def get_monitor_status(user: UserConfig = Depends(get_current_user)):
    """è·å–ç›‘æ§çŠ¶æ€"""
    return {
        "sec_user_id": user.sec_user_id,
        "monitoring": get_monitoring_state(user.user_id),
        "last_update": get_last_update_time(user.user_id),
        "accounts_count": get_following_count(user.user_id)
    }

@router.post("/start")
async def start_monitoring(user: UserConfig = Depends(get_current_user)):
    """å¼€å§‹ç›‘æ§ä»»åŠ¡ - é‡ç”¨åŸé¡¹ç›®çˆ¬è™«"""
    # å¯¼å…¥åŸé¡¹ç›®çˆ¬è™«
    from backend.crawler import DouyinCrawler
    
    if not user.sec_user_id:
        raise HTTPException(status_code=400, detail="è¯·å…ˆè®¾ç½®æŠ–éŸ³sec_user_id")
    
    # å¯åŠ¨åå°ä»»åŠ¡
    asyncio.create_task(run_monitoring_task(user))
    
    return {"message": "ç›‘æ§ä»»åŠ¡å·²å¯åŠ¨", "task_id": "..."}
```

## ç¬¬äºŒé˜¶æ®µï¼šç›‘æ§åŠŸèƒ½é‡æ„

### 2.1 å®šæ—¶ä»»åŠ¡åŒ…è£…å™¨
**æ–°æ–‡ä»¶**ï¼š`backend/monitor/scheduler.py`
```python
import asyncio
from datetime import datetime, timedelta
from typing import Dict, List
import sqlite3
from concurrent.futures import ThreadPoolExecutor, as_completed

class MonitoringScheduler:
    """ç›‘æ§è°ƒåº¦å™¨ - é‡ç”¨åŸé¡¹ç›®çˆ¬è™«"""
    
    def __init__(self, user_id: str):
        self.user_id = user_id
        self.crawler = None  # å»¶è¿Ÿåˆå§‹åŒ–åŸé¡¹ç›®çˆ¬è™«
        self.executor = ThreadPoolExecutor(max_workers=5)  # å¹¶è¡Œé‡‡é›†
        
    async def init_crawler(self):
        """å»¶è¿Ÿåˆå§‹åŒ–çˆ¬è™« - é‡ç”¨åŸé¡¹ç›®ä»£ç """
        if not self.crawler:
            # åŸé¡¹ç›®çš„çˆ¬è™«åˆå§‹åŒ–æ–¹å¼
            from backend.crawler import DouyinCrawler
            self.crawler = DouyinCrawler()
            
    async def monitor_following(self, sec_user_id: str):
        """ç›‘æ§ç”¨æˆ·å…³æ³¨åˆ—è¡¨"""
        await self.init_crawler()
        
        # 1. è·å–å…³æ³¨åˆ—è¡¨ - è°ƒç”¨åŸé¡¹ç›®æ–¹æ³•
        print(f"[{self.user_id}] å¼€å§‹è·å–å…³æ³¨åˆ—è¡¨...")
        following_list = await self.crawler.get_following_list(sec_user_id)
        
        # 2. å¹¶è¡Œé‡‡é›†æ¯ä¸ªè´¦å·çš„è§†é¢‘
        tasks = []
        for account in following_list[:50]:  # é™åˆ¶å‰50ä¸ªè´¦å·
            task = self.executor.submit(
                self.fetch_account_recent_videos,
                account['sec_uid'],
                account['nickname']
            )
            tasks.append(task)
        
        # 3. å¤„ç†ç»“æœ
        for future in as_completed(tasks):
            try:
                account_id, videos = future.result(timeout=30)
                if videos:
                    self.save_to_user_db(account_id, videos)
                    # å®æ—¶é€šçŸ¥å‰ç«¯æ›´æ–°
                    self.notify_frontend_update(account_id, videos)
            except Exception as e:
                print(f"é‡‡é›†å¤±è´¥: {e}")
        
        print(f"[{self.user_id}] å…³æ³¨åˆ—è¡¨ç›‘æ§å®Œæˆ")
    
    def fetch_account_recent_videos(self, account_sec_uid: str, account_name: str):
        """è·å–è´¦å·æœ€è¿‘3å¤©è§†é¢‘ - é‡ç”¨åŸé¡¹ç›®æ–¹æ³•"""
        # è°ƒç”¨åŸé¡¹ç›®çš„è§†é¢‘è·å–æ–¹æ³•
        all_videos = self.crawler.get_user_videos(account_sec_uid, limit=20)
        
        # è¿‡æ»¤è¿‘3å¤©
        three_days_ago = datetime.now() - timedelta(days=3)
        recent_videos = [
            v for v in all_videos 
            if datetime.fromtimestamp(v['create_time']) > three_days_ago
        ][:10]  # æœ€å¤š10ä¸ª
        
        return account_sec_uid, {
            'account_name': account_name,
            'account_id': account_sec_uid,
            'videos': recent_videos,
            'updated_at': datetime.now().isoformat()
        }
```

### 2.2 ç”¨æˆ·æ•°æ®å­˜å‚¨
**æ–°æ–‡ä»¶**ï¼š`backend/storage/user_db.py`
```python
import sqlite3
import os
from datetime import datetime

class UserDatabase:
    """ç”¨æˆ·ä¸“å±SQLiteæ•°æ®åº“"""
    
    def __init__(self, user_id: str):
        self.user_id = user_id
        db_path = os.path.join(UserConfig.get_user_data_dir(user_id), 'monitor_data.db')
        self.conn = sqlite3.connect(db_path, check_same_thread=False)
        self.init_tables()
    
    def init_tables(self):
        """åˆå§‹åŒ–ç”¨æˆ·æ•°æ®è¡¨"""
        cursor = self.conn.cursor()
        
        # å…³æ³¨è´¦å·è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS following_accounts (
                account_id TEXT PRIMARY KEY,
                sec_uid TEXT NOT NULL,
                nickname TEXT,
                follower_count INTEGER,
                last_updated TIMESTAMP,
                is_monitoring BOOLEAN DEFAULT 1
            )
        ''')
        
        # è§†é¢‘æ•°æ®è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS videos (
                video_id TEXT PRIMARY KEY,
                account_id TEXT,
                description TEXT,
                create_time INTEGER,
                like_count INTEGER,
                collect_count INTEGER,
                comment_count INTEGER,
                share_count INTEGER,
                cover_url TEXT,
                video_url TEXT,
                collected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                hourly_likes INTEGER DEFAULT 0,  # è¿‘ä¸€å°æ—¶ç‚¹èµå¢é‡
                FOREIGN KEY (account_id) REFERENCES following_accounts (account_id)
            )
        ''')
        
        # ç‚¹èµå†å²è¡¨ï¼ˆç”¨äºè®¡ç®—å°æ—¶å¢é‡ï¼‰
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS like_history (
                video_id TEXT,
                like_count INTEGER,
                recorded_at TIMESTAMP,
                PRIMARY KEY (video_id, recorded_at)
            )
        ''')
        
        self.conn.commit()
    
    def save_video_data(self, account_id: str, videos: list):
        """ä¿å­˜è§†é¢‘æ•°æ®å¹¶è®¡ç®—å¢é‡"""
        cursor = self.conn.cursor()
        
        for video in videos:
            # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            cursor.execute(
                "SELECT like_count FROM videos WHERE video_id = ?",
                (video['aweme_id'],)
            )
            existing = cursor.fetchone()
            
            # ä¿å­˜ç‚¹èµå†å²
            cursor.execute(
                '''INSERT INTO like_history (video_id, like_count, recorded_at) 
                   VALUES (?, ?, ?)''',
                (video['aweme_id'], video['statistics']['digg_count'], datetime.now())
            )
            
            # è®¡ç®—è¿‘ä¸€å°æ—¶ç‚¹èµå¢é‡
            hour_ago = datetime.now().timestamp() - 3600
            cursor.execute('''
                SELECT like_count FROM like_history 
                WHERE video_id = ? AND recorded_at >= ?
                ORDER BY recorded_at ASC LIMIT 1
            ''', (video['aweme_id'], hour_ago))
            
            hour_ago_likes = cursor.fetchone()
            hourly_inc = 0
            if hour_ago_likes:
                hourly_inc = video['statistics']['digg_count'] - hour_ago_likes[0]
            
            # æ’å…¥æˆ–æ›´æ–°è§†é¢‘æ•°æ®
            if existing:
                cursor.execute('''
                    UPDATE videos SET 
                        like_count = ?,
                        collect_count = ?,
                        comment_count = ?,
                        share_count = ?,
                        hourly_likes = ?,
                        collected_at = CURRENT_TIMESTAMP
                    WHERE video_id = ?
                ''', (
                    video['statistics']['digg_count'],
                    video['statistics']['collect_count'],
                    video['statistics']['comment_count'],
                    video['statistics']['share_count'],
                    hourly_inc,
                    video['aweme_id']
                ))
            else:
                cursor.execute('''
                    INSERT INTO videos VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                ''', (
                    video['aweme_id'],
                    account_id,
                    video['desc'],
                    video['create_time'],
                    video['statistics']['digg_count'],
                    video['statistics']['collect_count'],
                    video['statistics']['comment_count'],
                    video['statistics']['share_count'],
                    video['video']['cover']['url_list'][0],
                    video['video']['play_addr']['url_list'][0] if 'play_addr' in video['video'] else '',
                    datetime.now(),
                    hourly_inc
                ))
        
        self.conn.commit()
```

## ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç•Œé¢é‡æ„

### 3.1 ä¸»ä»ªè¡¨ç›˜é¡µé¢
**ä¿®æ”¹æ–‡ä»¶**ï¼š`frontend/src/pages/Dashboard.tsx`ï¼ˆåŸºäºåŸHome.tsxé‡æ„ï¼‰

```typescript
import React, { useState, useEffect, useCallback } from 'react';
import { 
  Table, Card, Row, Col, Statistic, Button, Tag, 
  Image, Input, Select, Progress, message 
} from 'antd';
import { 
  PlayCircleOutlined, DownloadOutlined, 
  EyeOutlined, SortAscendingOutlined 
} from '@ant-design/icons';
import { useWebSocket } from '../hooks/useWebSocket'; // é‡ç”¨åŸé¡¹ç›®WebSocket
import { api } from '../utils/request'; // é‡ç”¨åŸé¡¹ç›®APIè¯·æ±‚

const { Search } = Input;
const { Option } = Select;

interface VideoData {
  key: string;
  cover_url: string;
  account_name: string;
  video_desc: string;
  hourly_likes: number;
  total_likes: number;
  follower_count: number;
  video_url: string;
  account_id: string;
  updated_at: string;
}

const Dashboard: React.FC = () => {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<VideoData[]>([]);
  const [selectedRowKeys, setSelectedRowKeys] = useState<string[]>([]);
  const [sortField, setSortField] = useState<string>('hourly_likes');
  const [sortOrder, setSortOrder] = useState<'ascend' | 'descend'>('descend');
  
  // é‡ç”¨åŸé¡¹ç›®çš„WebSocketè¿æ¥
  const { lastMessage, sendMessage } = useWebSocket('ws://localhost:8000/ws');
  
  // åˆå§‹åŒ–åŠ è½½æ•°æ®
  useEffect(() => {
    fetchMonitoringData();
    
    // ç›‘å¬å®æ—¶æ›´æ–°
    if (lastMessage) {
      const update = JSON.parse(lastMessage.data);
      if (update.type === 'video_update') {
        handleRealTimeUpdate(update.data);
      }
    }
  }, [lastMessage]);
  
  const fetchMonitoringData = async () => {
    try {
      setLoading(true);
      // é‡ç”¨åŸé¡¹ç›®çš„APIè°ƒç”¨æ–¹å¼
      const response = await api.get('/api/monitor/data');
      setData(processTableData(response.data));
    } catch (error) {
      message.error('åŠ è½½æ•°æ®å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };
  
  const handleRealTimeUpdate = (newData: any) => {
    setData(prev => {
      const index = prev.findIndex(item => item.key === newData.video_id);
      if (index >= 0) {
        const updated = [...prev];
        updated[index] = { ...updated[index], ...newData };
        return updated;
      }
      return prev;
    });
  };
  
  const columns = [
    {
      title: 'ä½œå“å°é¢',
      dataIndex: 'cover_url',
      width: 100,
      render: (url: string, record: VideoData) => (
        <div style={{ position: 'relative' }}>
          <Image
            src={url}
            alt="å°é¢"
            width={80}
            height={60}
            style={{ borderRadius: 4, cursor: 'pointer' }}
            preview={{
              mask: <EyeOutlined />,
              src: url
            }}
          />
          <PlayCircleOutlined 
            style={{
              position: 'absolute',
              top: '50%',
              left: '50%',
              transform: 'translate(-50%, -50%)',
              fontSize: 24,
              color: 'rgba(255, 255, 255, 0.8)',
              cursor: 'pointer'
            }}
            onClick={() => window.open(record.video_url, '_blank')}
          />
        </div>
      )
    },
    {
      title: 'è´¦å·åç§°',
      dataIndex: 'account_name',
      width: 120,
      sorter: true,
      render: (text: string, record: VideoData) => (
        <div>
          <div>{text}</div>
          <Tag color="blue" style={{ fontSize: 10 }}>
            ç²‰ä¸: {(record.follower_count / 10000).toFixed(1)}w
          </Tag>
        </div>
      )
    },
    {
      title: 'ä½œå“åç§°',
      dataIndex: 'video_desc',
      width: 200,
      ellipsis: true,
      render: (text: string, record: VideoData) => (
        <a 
          href={record.video_url} 
          target="_blank" 
          rel="noopener noreferrer"
          style={{ color: '#1890ff' }}
        >
          {text || 'æ— æ ‡é¢˜'}
        </a>
      )
    },
    {
      title: 'è¿‘ä¸€å°æ—¶ç‚¹èµ',
      dataIndex: 'hourly_likes',
      width: 120,
      sorter: true,
      defaultSortOrder: 'descend' as 'descend',
      render: (value: number) => (
        <div style={{ 
          color: value > 0 ? '#52c41a' : value < 0 ? '#f5222d' : '#999',
          fontWeight: 'bold'
        }}>
          {value > 0 ? `+${value}` : value}
          {value > 1000 && <Tag color="red" style={{ marginLeft: 4 }}>çƒ­</Tag>}
        </div>
      )
    },
    {
      title: 'æ€»ç‚¹èµé‡',
      dataIndex: 'total_likes',
      width: 100,
      sorter: true,
      render: (value: number) => (
        <span style={{ fontWeight: 500 }}>
          {(value / 1000).toFixed(1)}k
        </span>
      )
    },
    {
      title: 'æ“ä½œ',
      width: 80,
      render: (_: any, record: VideoData) => (
        <Button
          type="primary"
          icon={<DownloadOutlined />}
          size="small"
          onClick={() => handleDownload(record)}
        >
          ä¸‹è½½
        </Button>
      )
    }
  ];
  
  const handleDownload = async (record: VideoData) => {
    // é‡ç”¨åŸé¡¹ç›®ä¸‹è½½API
    try {
      await api.post('/api/download', {
        url: record.video_url,
        filename: `${record.account_name}_${record.key}.mp4`
      });
      message.success('å·²æ·»åŠ åˆ°ä¸‹è½½é˜Ÿåˆ—');
    } catch (error) {
      message.error('ä¸‹è½½å¤±è´¥');
    }
  };
  
  const handleBatchDownload = () => {
    const selectedVideos = data.filter(item => 
      selectedRowKeys.includes(item.key)
    );
    // æ‰¹é‡ä¸‹è½½é€»è¾‘
    selectedVideos.forEach(video => handleDownload(video));
  };
  
  return (
    <div className="dashboard-container">
      {/* é¡¶éƒ¨çŠ¶æ€æ  - é‡ç”¨åŸé¡¹ç›®æ ·å¼ */}
      <Card className="status-card" style={{ marginBottom: 16 }}>
        <Row gutter={16}>
          <Col span={6}>
            <Statistic 
              title="ç›‘æ§ä¸­è´¦å·" 
              value={data.length > 0 ? new Set(data.map(d => d.account_id)).size : 0} 
            />
          </Col>
          <Col span={6}>
            <Statistic 
              title="ä»Šæ—¥æ›´æ–°è§†é¢‘" 
              value={data.length} 
            />
          </Col>
          <Col span={6}>
            <Statistic 
              title="è¿‘ä¸€å°æ—¶æ€»ç‚¹èµ" 
              value={data.reduce((sum, item) => sum + (item.hourly_likes > 0 ? item.hourly_likes : 0), 0)} 
            />
          </Col>
          <Col span={6}>
            <Button 
              type="primary" 
              onClick={fetchMonitoringData}
              loading={loading}
            >
              åˆ·æ–°æ•°æ®
            </Button>
          </Col>
        </Row>
      </Card>
      
      {/* æ‰¹é‡æ“ä½œæ  */}
      {selectedRowKeys.length > 0 && (
        <div style={{ marginBottom: 16, padding: 12, background: '#fafafa', borderRadius: 4 }}>
          å·²é€‰æ‹© {selectedRowKeys.length} ä¸ªè§†é¢‘
          <Button 
            type="primary" 
            icon={<DownloadOutlined />} 
            style={{ marginLeft: 16 }}
            onClick={handleBatchDownload}
          >
            æ‰¹é‡ä¸‹è½½
          </Button>
          <Button style={{ marginLeft: 8 }} onClick={() => setSelectedRowKeys([])}>
            å–æ¶ˆé€‰æ‹©
          </Button>
        </div>
      )}
      
      {/* æ•°æ®è¡¨æ ¼ - é‡ç”¨åŸé¡¹ç›®Tableç»„ä»¶ */}
      <Table
        columns={columns}
        dataSource={data}
        rowKey="key"
        loading={loading}
        rowSelection={{
          selectedRowKeys,
          onChange: setSelectedRowKeys,
        }}
        pagination={{
          pageSize: 20,
          showSizeChanger: true,
          showQuickJumper: true,
          showTotal: (total) => `å…± ${total} æ¡æ•°æ®`
        }}
        onChange={(pagination, filters, sorter) => {
          // å¤„ç†æ’åº
          if (Array.isArray(sorter)) {
            // å¤šåˆ—æ’åº
          } else if (sorter.field) {
            setSortField(sorter.field as string);
            setSortOrder(sorter.order as 'ascend' | 'descend');
          }
        }}
        scroll={{ x: 800 }}
      />
    </div>
  );
};

export default Dashboard;
```

## ç¬¬å››é˜¶æ®µï¼šç¦»çº¿æˆæƒç³»ç»Ÿ

### 4.1 ç‹¬ç«‹æˆæƒç ç”Ÿæˆå™¨ï¼ˆä»…ä½ ä½¿ç”¨ï¼‰
**æ–°æ–‡ä»¶**ï¼š`tools/license_generator.py`ï¼ˆä¸åŒ…å«åœ¨ç”¨æˆ·ç‰ˆæœ¬ï¼‰

```python
#!/usr/bin/env python3
"""
æˆæƒç ç”Ÿæˆå™¨ - ä»…ç”±é¡¹ç›®ç»´æŠ¤è€…ä½¿ç”¨
ä½¿ç”¨æ–¹æ³•ï¼špython license_generator.py --type month --count 10
"""
import argparse
import json
import base64
from datetime import datetime, timedelta
from ecdsa import SigningKey, NIST256p
import hashlib
import csv

class LicenseGenerator:
    def __init__(self):
        # ç”Ÿæˆæˆ–åŠ è½½ç§é’¥ï¼ˆé¦–æ¬¡è¿è¡Œç”Ÿæˆï¼‰
        self.private_key = self.load_or_create_private_key()
        self.public_key = self.private_key.verifying_key
        
    def load_or_create_private_key(self) -> SigningKey:
        """åŠ è½½æˆ–ç”Ÿæˆç§é’¥"""
        key_file = "private_key.pem"
        try:
            with open(key_file, 'rb') as f:
                return SigningKey.from_pem(f.read())
        except FileNotFoundError:
            print("âš ï¸  æœªæ‰¾åˆ°ç§é’¥æ–‡ä»¶ï¼Œç”Ÿæˆæ–°å¯†é’¥...")
            new_key = SigningKey.generate(curve=NIST256p)
            with open(key_file, 'wb') as f:
                f.write(new_key.to_pem())
            
            # åŒæ—¶ç”Ÿæˆä¾›å®¢æˆ·ç«¯ä½¿ç”¨çš„å…¬é’¥æ–‡ä»¶
            public_key_hex = new_key.verifying_key.to_string().hex()
            with open('public_key.txt', 'w') as f:
                f.write(public_key_hex)
            print(f"âœ… å·²ç”Ÿæˆå…¬é’¥ï¼š{public_key_hex[:50]}...")
            
            return new_key
    
    def generate_serial(self) -> str:
        """ç”Ÿæˆåºåˆ—å·"""
        timestamp = int(datetime.now().timestamp() * 1000)
        random = hashlib.md5(str(timestamp).encode()).hexdigest()[:8].upper()
        return f"{timestamp:016X}{random}"
    
    def generate_license(self, license_type: str, days: int) -> str:
        """ç”Ÿæˆå•ä¸ªæˆæƒç """
        # è®¡ç®—è¿‡æœŸæ—¶é—´
        expiry_date = datetime.now() + timedelta(days=days)
        
        # æ„å»ºè®¸å¯è¯æ•°æ®
        license_data = {
            "version": "V2",
            "type": license_type.upper(),
            "expiry": expiry_date.isoformat(),
            "serial": self.generate_serial(),
            "generated": datetime.now().isoformat(),
            "days": days
        }
        
        # ç­¾å
        data_str = json.dumps(license_data, sort_keys=True, separators=(',', ':'))
        signature = self.private_key.sign(data_str.encode('utf-8'))
        
        # ç»„åˆ
        full_data = {
            "data": license_data,
            "sig": base64.b64encode(signature).decode('utf-8')
        }
        
        # ç¼–ç ä¸ºæœ€ç»ˆæˆæƒç 
        encoded = base64.b64encode(
            json.dumps(full_data, separators=(',', ':')).encode('utf-8')
        ).decode('utf-8')
        
        return encoded
    
    def generate_batch(self, license_type: str, count: int) -> list:
        """ç”Ÿæˆæ‰¹æ¬¡æˆæƒç """
        type_map = {
            "month": 30,
            "half_year": 180,
            "year": 365
        }
        
        if license_type not in type_map:
            raise ValueError(f"ç±»å‹é”™è¯¯ï¼Œå¯é€‰ï¼š{list(type_map.keys())}")
        
        days = type_map[license_type]
        licenses = []
        
        for i in range(count):
            license_code = self.generate_license(license_type, days)
            licenses.append({
                "ç¼–å·": i + 1,
                "ç±»å‹": license_type,
                "å¤©æ•°": days,
                "è¿‡æœŸæ—¥æœŸ": (datetime.now() + timedelta(days=days)).strftime("%Y-%m-%d"),
                "æˆæƒç ": license_code,
                "ç”Ÿæˆæ—¶é—´": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            })
            
            print(f"âœ… ç”Ÿæˆ {license_type} æˆæƒç  {i+1}/{count}")
        
        return licenses
    
    def export_to_csv(self, licenses: list, filename: str = None):
        """å¯¼å‡ºä¸ºCSVæ–‡ä»¶"""
        if not filename:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"licenses_{timestamp}.csv"
        
        with open(filename, 'w', newline='', encoding='utf-8-sig') as f:
            fieldnames = ["ç¼–å·", "ç±»å‹", "å¤©æ•°", "è¿‡æœŸæ—¥æœŸ", "æˆæƒç ", "ç”Ÿæˆæ—¶é—´"]
            writer = csv.DictWriter(f, fieldnames=fieldnames)
            writer.writeheader()
            writer.writerows(licenses)
        
        print(f"ğŸ“ å·²å¯¼å‡ºåˆ° {filename}")
        return filename

def main():
    parser = argparse.ArgumentParser(description="æŠ–éŸ³ç›‘æ§å¹³å°æˆæƒç ç”Ÿæˆå™¨")
    parser.add_argument("--type", required=True, 
                       choices=["month", "half_year", "year"],
                       help="æˆæƒç±»å‹ï¼šmonth(æœˆå¡), half_year(åŠå¹´å¡), year(å¹´å¡)")
    parser.add_argument("--count", type=int, default=10,
                       help="ç”Ÿæˆæ•°é‡ï¼Œé»˜è®¤10ä¸ª")
    parser.add_argument("--export", action="store_true",
                       help="æ˜¯å¦å¯¼å‡ºä¸ºCSVæ–‡ä»¶")
    
    args = parser.parse_args()
    
    generator = LicenseGenerator()
    
    print(f"ğŸš€ å¼€å§‹ç”Ÿæˆ {args.count} ä¸ª{args.type}æˆæƒç ...")
    licenses = generator.generate_batch(args.type, args.count)
    
    # æ˜¾ç¤ºæ ·æœ¬
    print("\n" + "="*60)
    print("æˆæƒç æ ·æœ¬ï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼š")
    print("="*60)
    print(f"ç±»å‹: {licenses[0]['ç±»å‹']}")
    print(f"å¤©æ•°: {licenses[0]['å¤©æ•°']}")
    print(f"è¿‡æœŸ: {licenses[0]['è¿‡æœŸæ—¥æœŸ']}")
    print(f"æˆæƒç : {licenses[0]['æˆæƒç '][:50]}...")
    print("="*60)
    
    if args.export:
        generator.export_to_csv(licenses)

if __name__ == "__main__":
    main()
```

### 4.2 å®¢æˆ·ç«¯æˆæƒæ¿€æ´»ç»„ä»¶
**æ–°æ–‡ä»¶**ï¼š`frontend/src/components/LicenseActivate.tsx`

```typescript
import React, { useState } from 'react';
import { Modal, Form, Input, Button, Alert, Typography, Steps } from 'antd';
import { KeyOutlined, SafetyCertificateOutlined, CheckCircleOutlined } from '@ant-design/icons';
import { api } from '../utils/request';

const { Step } = Steps;
const { Paragraph, Text } = Typography;

interface LicenseActivateProps {
  visible: boolean;
  onSuccess: () => void;
  onCancel: () => void;
  isTrialExpired: boolean;
}

const LicenseActivate: React.FC<LicenseActivateProps> = ({
  visible,
  onSuccess,
  onCancel,
  isTrialExpired
}) => {
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [currentStep, setCurrentStep] = useState(0);
  const [licenseInfo, setLicenseInfo] = useState<any>(null);
  
  const handleActivate = async (values: { licenseKey: string }) => {
    setLoading(true);
    try {
      // è°ƒç”¨åç«¯éªŒè¯æ¥å£
      const response = await api.post('/api/auth/activate', {
        license_key: values.licenseKey
      });
      
      if (response.data.valid) {
        setLicenseInfo(response.data);
        setCurrentStep(1);
        // å»¶è¿Ÿè·³è½¬åˆ°æ­¥éª¤2
        setTimeout(() => {
          setCurrentStep(2);
          // 3ç§’åå…³é—­å¼¹çª—
          setTimeout(() => {
            onSuccess();
          }, 3000);
        }, 1500);
      } else {
        throw new Error(response.data.error || 'æˆæƒç æ— æ•ˆ');
      }
    } catch (error: any) {
      Modal.error({
        title: 'æ¿€æ´»å¤±è´¥',
        content: error.message || 'è¯·æ£€æŸ¥æˆæƒç æ˜¯å¦æ­£ç¡®'
      });
    } finally {
      setLoading(false);
    }
  };
  
  const steps = [
    {
      title: 'è¾“å…¥æˆæƒç ',
      icon: <KeyOutlined />,
      content: (
        <Form form={form} onFinish={handleActivate}>
          {isTrialExpired && (
            <Alert
              type="warning"
              message="è¯•ç”¨æœŸå·²ç»“æŸ"
              description="è¯·è¾“å…¥æœ‰æ•ˆçš„æˆæƒç ä»¥ç»§ç»­ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½"
              style={{ marginBottom: 16 }}
              showIcon
            />
          )}
          
          <Form.Item
            name="licenseKey"
            rules={[
              { required: true, message: 'è¯·è¾“å…¥æˆæƒç ' },
              { min: 50, message: 'æˆæƒç æ ¼å¼ä¸æ­£ç¡®' }
            ]}
          >
            <Input.TextArea
              placeholder="è¯·è¾“å…¥æˆæƒç ï¼ˆé€šå¸¸ç”±60-80ä½å­—ç¬¦ç»„æˆï¼‰"
              rows={4}
              allowClear
            />
          </Form.Item>
          
          <div style={{ marginTop: 16 }}>
            <Paragraph type="secondary">
              <SafetyCertificateOutlined /> æˆæƒç è¯´æ˜ï¼š
            </Paragraph>
            <ul style={{ color: '#666', fontSize: 12 }}>
              <li>æœˆå¡ï¼š30å¤©ä½¿ç”¨æƒï¼Œé€‚åˆçŸ­æœŸä½“éªŒ</li>
              <li>åŠå¹´å¡ï¼š180å¤©ä½¿ç”¨æƒï¼Œæ€§ä»·æ¯”é«˜</li>
              <li>å¹´å¡ï¼š365å¤©ä½¿ç”¨æƒï¼Œæœ€ä¼˜æƒ </li>
              <li>æˆæƒç ä¸è®¾å¤‡ç»‘å®šï¼Œè¯·å¦¥å–„ä¿ç®¡</li>
            </ul>
          </div>
        </Form>
      )
    },
    {
      title: 'éªŒè¯ä¸­',
      icon: <SafetyCertificateOutlined />,
      content: (
        <div style={{ textAlign: 'center', padding: '40px 20px' }}>
          <div style={{ marginBottom: 20 }}>
            <SafetyCertificateOutlined style={{ fontSize: 48, color: '#1890ff' }} />
          </div>
          <Paragraph>æ­£åœ¨éªŒè¯æˆæƒç ï¼Œè¯·ç¨å€™...</Paragraph>
        </div>
      )
    },
    {
      title: 'æ¿€æ´»æˆåŠŸ',
      icon: <CheckCircleOutlined />,
      content: licenseInfo && (
        <div style={{ textAlign: 'center', padding: '20px' }}>
          <CheckCircleOutlined style={{ fontSize: 64, color: '#52c41a', marginBottom: 20 }} />
          <Paragraph strong style={{ fontSize: 16 }}>
            æˆæƒæ¿€æ´»æˆåŠŸï¼
          </Paragraph>
          <div style={{ background: '#fafafa', padding: 16, borderRadius: 4, marginTop: 16 }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
              <Text type="secondary">æˆæƒç±»å‹ï¼š</Text>
              <Text strong>
                {licenseInfo.type === 'MONTH' ? 'æœˆå¡' : 
                 licenseInfo.type === 'HALF_YEAR' ? 'åŠå¹´å¡' : 'å¹´å¡'}
              </Text>
            </div>
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
              <Text type="secondary">è¿‡æœŸæ—¶é—´ï¼š</Text>
              <Text strong>{licenseInfo.expiry}</Text>
            </div>
            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
              <Text type="secondary">å‰©ä½™å¤©æ•°ï¼š</Text>
              <Text strong type="success">{licenseInfo.remaining_days} å¤©</Text>
            </div>
          </div>
          <Paragraph type="secondary" style={{ marginTop: 16 }}>
            çª—å£å°†åœ¨3ç§’åè‡ªåŠ¨å…³é—­...
          </Paragraph>
        </div>
      )
    }
  ];
  
  return (
    <Modal
      title="æˆæƒæ¿€æ´»"
      visible={visible}
      onCancel={onCancel}
      footer={
        currentStep === 0 ? (
          <>
            <Button onClick={onCancel}>å–æ¶ˆ</Button>
            <Button
              type="primary"
              loading={loading}
              onClick={() => form.submit()}
            >
              æ¿€æ´»æˆæƒ
            </Button>
          </>
        ) : null
      }
      width={500}
      closable={currentStep === 0}
      maskClosable={false}
    >
      <Steps current={currentStep} size="small" style={{ marginBottom: 24 }}>
        {steps.map(step => (
          <Step key={step.title} title={step.title} icon={step.icon} />
        ))}
      </Steps>
      
      <div style={{ minHeight: 200 }}>
        {steps[currentStep].content}
      </div>
    </Modal>
  );
};

export default LicenseActivate;
```

## ç¬¬äº”é˜¶æ®µï¼šæ‰“åŒ…ä¸é›†æˆ

### 5.1 ä¿®æ”¹å¯åŠ¨æµç¨‹
**ä¿®æ”¹æ–‡ä»¶**ï¼š`main.py`ï¼ˆæ¡Œé¢åº”ç”¨å…¥å£ï¼‰

```python
#!/usr/bin/env python3
"""
æŠ–éŸ³ç›‘æ§å¹³å° - æ¡Œé¢åº”ç”¨å…¥å£
åŸºäºåŸé¡¹ç›®main.pyä¿®æ”¹
"""
import sys
import os
import json
from datetime import datetime, timedelta

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

def check_license():
    """å¯åŠ¨æ—¶æ£€æŸ¥æˆæƒçŠ¶æ€"""
    from backend.auth.license_manager import LicenseManager
    from backend.models import UserConfig
    
    # åŠ è½½ç”¨æˆ·é…ç½®
    user_config = UserConfig()
    
    # æ£€æŸ¥è¯•ç”¨æœŸ
    if not LicenseManager.check_trial_period(user_config):
        print("è¯•ç”¨æœŸå·²ç»“æŸï¼Œéœ€è¦æ¿€æ´»æˆæƒ")
        return False, "trial_expired"
    
    # æ£€æŸ¥æ­£å¼æˆæƒ
    if user_config.license_key:
        result = LicenseManager.verify_license(user_config.license_key)
        if not result["valid"]:
            print(f"æˆæƒæ— æ•ˆ: {result.get('error')}")
            return False, "license_invalid"
    
    return True, "ok"

def main():
    """ä¸»å…¥å£å‡½æ•°"""
    print("=" * 50)
    print("æŠ–éŸ³æ•°æ®ç›‘æ§å¹³å° v2.0")
    print("=" * 50)
    
    # æ£€æŸ¥æˆæƒ
    is_valid, status = check_license()
    
    if not is_valid:
        if status == "trial_expired":
            # å¯åŠ¨æˆæƒæ¿€æ´»ç•Œé¢
            from backend.gui.license_activate import show_license_activate
            if not show_license_activate():
                print("æˆæƒæ¿€æ´»å¤±è´¥ï¼Œç¨‹åºé€€å‡º")
                sys.exit(1)
        else:
            print("æˆæƒæ£€æŸ¥å¤±è´¥ï¼Œç¨‹åºé€€å‡º")
            sys.exit(1)
    
    # æ£€æŸ¥sec_user_idæ˜¯å¦è®¾ç½®
    from backend.models import UserConfig
    user_config = UserConfig()
    
    if not user_config.sec_user_id:
        print("é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·è®¾ç½®æŠ–éŸ³sec_user_id")
        # å¯åŠ¨è®¾ç½®å‘å¯¼
        from backend.gui.setup_wizard import show_setup_wizard
        show_setup_wizard()
    
    # å¯åŠ¨ä¸»ç•Œé¢ - é‡ç”¨åŸé¡¹ç›®PyWebView
    try:
        import webview
        
        # åˆ›å»ºçª—å£ - ä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´
        window = webview.create_window(
            'æŠ–éŸ³æ•°æ®ç›‘æ§å¹³å°',
            'http://localhost:8000',  # æœ¬åœ°WebæœåŠ¡
            width=1200,
            height=800,
            min_size=(800, 600),
            resizable=True
        )
        
        # å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼ˆé‡ç”¨åŸé¡¹ç›®server.pyï¼‰
        import threading
        from backend.server import start_server
        
        server_thread = threading.Thread(target=start_server, daemon=True)
        server_thread.start()
        
        print("ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼")
        print("ğŸ“Š è¯·è®¿é—® http://localhost:8000")
        
        # å¯åŠ¨çª—å£
        webview.start()
        
    except Exception as e:
        print(f"å¯åŠ¨å¤±è´¥: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

### 5.2 ä¿®æ”¹æ„å»ºè„šæœ¬
**ä¿®æ”¹æ–‡ä»¶**ï¼š`scripts/build/pyinstaller.ps1`

```powershell
# åœ¨åŸæ‰“åŒ…è„šæœ¬åŸºç¡€ä¸Šä¿®æ”¹
# ä¸»è¦æ”¹åŠ¨ï¼šåŒ…å«æ–°çš„æ¨¡å—å’Œèµ„æºæ–‡ä»¶

# 1. æ·»åŠ æ–°æ¨¡å—åˆ°éšè—å¯¼å…¥
$hiddenImports = @(
    "backend.auth.license_manager",
    "backend.monitor.scheduler",
    "backend.storage.user_db",
    "backend.models",
    "ecdsa",
    "sqlite3"
)

# 2. æ·»åŠ æ•°æ®æ–‡ä»¶ï¼ˆç”¨æˆ·æ•°æ®ç›®å½•æ¨¡æ¿ï¼‰
$datas = @(
    ("config/template_user_config.json", "config"),
    ("backend/auth/public_key.txt", "backend/auth")
)

# 3. ä¿®æ”¹specæ–‡ä»¶ç”Ÿæˆéƒ¨åˆ†
$specContent = @"
# -*- mode: python ; coding: utf-8 -*-
block_cipher = None

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('frontend/dist', 'frontend/dist'),
        ('config/template_user_config.json', 'config'),
        ('backend/auth/public_key.txt', 'backend/auth'),
        ('aria2', 'aria2')
    ],
    hiddenimports=[
        'backend.auth.license_manager',
        'backend.monitor.scheduler',
        'backend.storage.user_db',
        'backend.models',
        'ecdsa',
        'sqlite3'
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    noarchive=False,
)

pyz = PYZ(a.pure)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.datas,
    [],
    name='DouyinMonitor',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,  # æ”¹ä¸ºFalseéšè—æ§åˆ¶å°
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='assets/icon.ico'
)
"@
```

## å¼€å‘æ£€æŸ¥æ¸…å•

### âœ… å¿…é¡»å®Œæˆçš„æ ¸å¿ƒä¿®æ”¹
1. **ç”¨æˆ·ç³»ç»Ÿ**
   - [ ] `backend/models.py` - æ‰©å±•ç”¨æˆ·é…ç½®æ¨¡å‹
   - [ ] `backend/auth/license_manager.py` - æˆæƒéªŒè¯
   - [ ] `backend/storage/user_db.py` - ç”¨æˆ·æ•°æ®åº“

2. **ç›‘æ§åŠŸèƒ½**
   - [ ] `backend/monitor/scheduler.py` - å®šæ—¶ä»»åŠ¡åŒ…è£…å™¨
   - [ ] `backend/routers/monitor.py` - ç›‘æ§APIè·¯ç”±
   - [ ] é‡ç”¨åŸçˆ¬è™«ï¼š`backend/crawler/`ï¼ˆé›¶ä¿®æ”¹ï¼‰

3. **å‰ç«¯ç•Œé¢**
   - [ ] `frontend/src/pages/Dashboard.tsx` - ä¸»ä»ªè¡¨ç›˜
   - [ ] `frontend/src/components/LicenseActivate.tsx` - æˆæƒæ¿€æ´»
   - [ ] `frontend/src/components/VideoPlayer.tsx` - è§†é¢‘æ’­æ”¾å™¨

4. **æˆæƒç³»ç»Ÿ**
   - [ ] `tools/license_generator.py` - æˆæƒç ç”Ÿæˆå™¨ï¼ˆç‹¬ç«‹ï¼‰
   - [ ] å…¬é’¥æ–‡ä»¶ï¼š`backend/auth/public_key.txt`

5. **å¯åŠ¨æµç¨‹**
   - [ ] `main.py` - ä¿®æ”¹å¯åŠ¨æˆæƒæ£€æŸ¥
   - [ ] `backend/server.py` - é›†æˆæˆæƒä¸­é—´ä»¶

### âš ï¸ ä¿æŒä¸å˜çš„åŸæœ‰ä»£ç 
1. **çˆ¬è™«æ ¸å¿ƒ**ï¼š`backend/crawler/` æ‰€æœ‰æ–‡ä»¶
2. **ä¸‹è½½åŠŸèƒ½**ï¼š`aria2/` é…ç½®å’Œé›†æˆ
3. **åŸºç¡€æ¡†æ¶**ï¼šFastAPIã€Reactã€TypeScripté…ç½®
4. **æ„å»ºç³»ç»Ÿ**ï¼šæ‰“åŒ…è„šæœ¬åŸºæœ¬é€»è¾‘

### ğŸ”§ ç¯å¢ƒä¸ä¾èµ–
```bash
# åœ¨åŸé¡¹ç›®ä¾èµ–åŸºç¡€ä¸Šæ–°å¢
# requirements.txt æ–°å¢ï¼š
ecdsa>=0.18.0
apscheduler>=3.10.0  # å®šæ—¶ä»»åŠ¡
diskcache>=5.6.0     # ç£ç›˜ç¼“å­˜

# package.json æ–°å¢ï¼š
"viewerjs": "^1.11.0"     # å›¾ç‰‡é¢„è§ˆ
"video.js": "^8.0.0"      # è§†é¢‘æ’­æ”¾
"react-video-js-player": "^1.0.0"
```

## æµ‹è¯•è¦ç‚¹

1. **æˆæƒç³»ç»Ÿæµ‹è¯•**
   - è¯•ç”¨æœŸ24å°æ—¶å‡†ç¡®è®¡æ—¶
   - æˆæƒç ç”Ÿæˆä¸éªŒè¯
   - è¿‡æœŸæˆæƒç æ‹’ç»

2. **æ•°æ®ç›‘æ§æµ‹è¯•**
   - 1000ä¸ªä½œå“é‡‡é›†æ€§èƒ½ï¼ˆç›®æ ‡90ç§’ï¼‰
   - è¾¹é‡‡é›†è¾¹å±•ç¤ºåŠŸèƒ½
   - è¿‘ä¸‰å¤©è§†é¢‘è¿‡æ»¤å‡†ç¡®

3. **ç•Œé¢äº¤äº’æµ‹è¯•**
   - è¡¨æ ¼æ’åºã€ç­›é€‰åŠŸèƒ½
   - å›¾ç‰‡ç‚¹å‡»æ”¾å¤§é¢„è§ˆ
   - è§†é¢‘ç‚¹å‡»æ’­æ”¾
   - æ‰¹é‡ä¸‹è½½æ“ä½œ

4. **ç¦»çº¿åŠŸèƒ½æµ‹è¯•**
   - æ–­ç½‘ç¯å¢ƒä¸‹æ­£å¸¸è¿è¡Œ
   - æœ¬åœ°æ•°æ®æŒä¹…åŒ–
   - æˆæƒç¦»çº¿éªŒè¯

## éƒ¨ç½²è¯´æ˜

### å¼€å‘è€…ï¼ˆä½ ï¼‰çš„éƒ¨ç½²æµç¨‹ï¼š
1. ç”Ÿæˆå¯†é’¥å¯¹ï¼šè¿è¡Œä¸€æ¬¡ `tools/license_generator.py`
2. ä¿ç®¡å¥½ `private_key.pem`ï¼ˆç»ä¸åˆ†å‘ï¼‰
3. å°† `public_key.txt` å¤åˆ¶åˆ° `backend/auth/`
4. ç”Ÿæˆæˆæƒç ï¼š`python tools/license_generator.py --type month --count 100 --export`
5. å°†æˆæƒç åˆ†å‘ç»™ç”¨æˆ·

### ç”¨æˆ·çš„å®‰è£…æµç¨‹ï¼š
1. ä¸‹è½½ `DouyinMonitor.exe`
2. é¦–æ¬¡è¿è¡Œ â†’ è®¾ç½®æŠ–éŸ³sec_user_id â†’ å¼€å§‹24å°æ—¶è¯•ç”¨
3. è¯•ç”¨æœŸç»“æŸ â†’ è¾“å…¥æˆæƒç æ¿€æ´»
4. æ­£å¸¸ä½¿ç”¨ç›‘æ§åŠŸèƒ½

---

**é‡è¦æé†’**ï¼š
1. æ‰€æœ‰ä»£ç ä¿®æ”¹éƒ½åŸºäºåŸé¡¹ç›®ç»“æ„ï¼Œç¡®ä¿å‘åå…¼å®¹
2. å…³é”®ä¸šåŠ¡é€»è¾‘ï¼ˆçˆ¬è™«ã€ä¸‹è½½ï¼‰ä¿æŒé›¶ä¿®æ”¹
3. æ–°åŠŸèƒ½é€šè¿‡åŒ…è£…å’Œæ‰©å±•æ–¹å¼å®ç°
4. ä¿æŒåŸé¡¹ç›®UIé£æ ¼ä¸€è‡´

ç°åœ¨å¯ä»¥å¼€å§‹æŒ‰ç…§è¿™ä¸ªæç¤ºè¯è¿›è¡Œå¼€å‘ã€‚æ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„å®ç°è·¯å¾„å’Œä»£ç ç¤ºä¾‹ï¼Œç¡®ä¿åœ¨åŸæœ‰ä»£ç åŸºç¡€ä¸Šè¿›è¡Œæœ€å°åŒ–ä¿®æ”¹ã€‚